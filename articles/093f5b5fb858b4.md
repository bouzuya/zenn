---
emoji: "ğŸ“"
publication_name: "doctormate"
published: true
published_at: 2026-02-16 12:00
title: "axum crate ã® IntoResponse ã®æ¨™æº–ã§æä¾›ã•ã‚Œã‚‹å®Ÿè£… (2)"
topics: ["rust"]
type: "tech"
---

[å‰å›ã¯ axum crate ã® IntoResponse ã®æ¨™æº–ã§æä¾›ã•ã‚Œã‚‹å®Ÿè£…ã‚’è¦‹ã¾ã—ãŸ](https://zenn.dev/doctormate/articles/093f5b5fb858b4)ã€‚

å…·ä½“çš„ã«ã¯æ¬¡ã®ã‚ˆã†ãªã‚‚ã®ã‚’è¦‹ã¾ã—ãŸã€‚

- `impl<B> IntoResponse for Response<B>`
- `impl IntoResponse for Body`
- `impl IntoResponse for Parts`
- `impl<R> IntoResponse for (Parts, R)`

æœ€å¾Œã®ã‚‚ã®ã¯ç‰¹ã« T16 ã¾ã§ã®å¯å¤‰ã® `IntoResponseParts` ã¨ 1 ã¤ã® `IntoResponse` ã‚’å–ã‚‹å¤šãã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å«ã‚€ã‚‚ã®ã§ã—ãŸã€‚

ä»Šå›ã¯å‰å›ã«ç¶šã axum crate ã® `IntoResponse` trait ã®å®Ÿè£…ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚

ä»Šå›ã‚‚ axum crate ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ 0.8.6 ã§ã™ã€‚

## impl&lt;T, E&gt; IntoResponse for Result&lt;T, E&gt;

`T: IntoResponse, E: IntoResponse`

<https://docs.rs/axum/0.8.6/axum/response/trait.IntoResponse.html#impl-IntoResponse-for-Result%3CT,+E%3E>

```rust
impl<T, E> IntoResponse for Result<T, E>
where
    T: IntoResponse,
    E: IntoResponse,
{
    fn into_response(self) -> Response {
        match self {
            Ok(value) => value.into_response(),
            Err(err) => err.into_response(),
        }
    }
}
```

`Result` ã‚’æ‰±ã†ã‚‚ã®ã§ã™ã€‚ç°¡å˜ãªå®šç¾©ãªã‚“ã§ã™ã‘ã©ã€é‡è¦ã§ã™ã€‚

ã“ã‚Œã®ãŠã‹ã’ã§ `E` ã‚’ `IntoResponse` ã«ã•ãˆã™ã‚Œã°ç‹¬è‡ªã®ã‚¨ãƒ©ãƒ¼ã§ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒã§ãã¾ã™ã€‚

## impl IntoResponse for PathRejection

<https://docs.rs/axum/0.8.6/axum/response/trait.IntoResponse.html#impl-IntoResponse-for-PathRejection>

å®Ÿè£…ã‚’è¦‹ã‚‹å‰ã«ã™ã“ã—èª¬æ˜ã‚’ã€‚

`impl IntoResponse for PathRejection` ã¯ Rejection ã‚’æ‰±ã†ã‚‚ã®ã®ä¾‹ã§ã™ã€‚ Rejection ã¨ã„ã† suffix ã®ãƒ‡ãƒ¼ã‚¿å‹ã¯ã„ãã¤ã‹ã‚ã‚Šã€ Extractor ã®ã‚¨ãƒ©ãƒ¼ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

ãŸã¨ãˆã° `PathRejection` ã¯ `Path` Extractor ã® `impl<T, S> FromRequestParts<S> for Path<T>` ã§ `FromRequestParts` ã®é–¢é€£å‹ã§ã‚ã‚‹ `type Rejection` ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

- <https://docs.rs/axum/0.8.6/axum/extract/rejection/enum.PathRejection.html>
- <https://docs.rs/axum/0.8.6/axum/extract/struct.Path.html>
- <https://docs.rs/axum/0.8.6/axum/extract/struct.Path.html#impl-FromRequestParts%3CS%3E-for-Path%3CT%3E>

Extractor ã®å¤±æ•—æ™‚ã«è¿”ã•ã‚Œã‚‹ã‚¨ãƒ©ãƒ¼å‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚

å„ Extractor ã¯ãã‚Œãã‚Œã® Rejection ã‚’æŒã£ã¦ã„ã‚‹ã“ã¨ãŒå¤šãã†ã§ã™ã€‚

ãã—ã¦å®Ÿè£…ã‚’è¦‹ã¾ã™ã€‚

```rust
composite_rejection! {
    /// Rejection used for [`Path`](super::Path).
    ///
    /// Contains one variant for each way the [`Path`](super::Path) extractor
    /// can fail.
    pub enum PathRejection {
        FailedToDeserializePathParams,
        MissingPathParams,
    }
}
```

`composite_rejection!` ã¯ axum-core ã®â†“ã§å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚

<https://github.com/tokio-rs/axum/blob/axum-v0.8.6/axum-core/src/macros.rs#L154>

```rust
macro_rules! __composite_rejection {
    (
        $(#[$m:meta])*
        pub enum $name:ident {
            $($variant:ident),+
            $(,)?
        }
    ) => {
        $(#[$m])*
        #[derive(Debug)]
        #[non_exhaustive]
        pub enum $name {
            $(
                #[allow(missing_docs)]
                $variant($variant)
            ),+
        }


        impl $crate::response::IntoResponse for $name {
            fn into_response(self) -> $crate::response::Response {
                match self {
                    $(
                        Self::$variant(inner) => inner.into_response(),
                    )+
                }
            }
        }

        // ...
    };
}
```

å„ variant name ã¨åŒä¸€åã®å‹ã«å‡¦ç†ã‚’è»¢é€ã™ã‚‹ã‚ˆã†ãªãƒã‚¯ãƒ­ã§ã™ã€‚ã„ãã¤ã‹ã®ãƒ¡ã‚½ãƒƒãƒ‰ãªã©ã‚’è»¢é€ã—ã¦ã„ã‚‹ã®ã§ã™ãŒã€ã“ã“ã§ã¯ `IntoResponse` ã ã‘ã‚ã‚Œã°ååˆ†ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ããã†ã§ã™ã€‚

`PathRejection` ã® `FailedToDeserializePathParams` ãªã‚‰â†“ã®å‹ã«è»¢é€ã—ã¦ã„ã¾ã™ã€‚

<https://docs.rs/axum/0.8.6/axum/extract/path/struct.FailedToDeserializePathParams.html>

åŒã˜ã‚ˆã†ãª Rejection ã§ã‚‚ `enum` ã§ãªã `struct` ã®å ´åˆã‚‚ã‚ã‚Šã¾ã™ã€‚

`NestedPath` Extractor ã®ãŸã‚ã® `NestedPathRejection` ã¯ `struct` ã§ã™ã€‚ã“ã‚Œã‚‚ `impl<S> FromRequestParts<S> for NestedPath` ã® `type Rejection` ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

- <https://docs.rs/axum/0.8.6/axum/extract/struct.NestedPath.html>
- <https://docs.rs/axum/0.8.6/axum/extract/rejection/struct.NestedPathRejection.html>
- <https://docs.rs/axum/0.8.6/axum/extract/struct.NestedPath.html#impl-FromRequestParts%3CS%3E-for-NestedPath>

å®Ÿè£…ã¯â†“ã§ã™ã€‚

```rust
define_rejection! {
    #[status = INTERNAL_SERVER_ERROR]
    #[body = "The matched route is not nested"]
    /// Rejection type for [`NestedPath`](super::NestedPath).
    ///
    /// This rejection is used if the matched route wasn't nested.
    pub struct NestedPathRejection;
}
```

`define_rejection` ã¯ axum-core ã§å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚

```rust
macro_rules! __define_rejection {
    (
        #[status = $status:ident]
        #[body = $body:literal]
        $(#[$m:meta])*
        pub struct $name:ident;
    ) => {
        $(#[$m])*
        #[derive(Debug)]
        #[non_exhaustive]
        pub struct $name;

        // ...

        impl $crate::response::IntoResponse for $name {
            fn into_response(self) -> $crate::response::Response {
                let status = self.status();


                $crate::__log_rejection!(
                    rejection_type = $name,
                    body_text = $body,
                    status = status,
                );
                (status, $body).into_response()
            }
        }

        // ...
    };


    (
        #[status = $status:ident]
        #[body = $body:literal]
        $(#[$m:meta])*
        pub struct $name:ident (Error);
    ) => {
        // ...
    };
}
```

ã“ã¡ã‚‰ã¯ field ã«ä½•ã‚‚æŒãŸãªã„å‹ã‚„ `Error` ã‚’æŒã£ãŸå‹ãªã©ã‚’å®šç¾©ã™ã‚‹ã‚‚ã®ã§ã™ã€‚ã•ãã»ã©ã® macro ã¨åŒæ§˜ã«ã„ã‚ã„ã‚ãªè»¢é€ã‚’ã—ã¦ã„ã¾ã™ã€‚

å€‹äººçš„ã«ã¯ macro_rules! ã«ãã“ã¾ã§æ…£ã‚Œã¦ã„ãªã„ã®ã§ã€ã“ã†ã„ã†ã“ã¨ã‚‚ã§ãã‚‹ã‚“ã â€¦â€¦ã¨å‹‰å¼·ã«ãªã‚Šã¾ã™ã€‚

## ãŠã‚ã‚Šã«

ä»Šå›ã¯ axum crate ã® IntoResponse ã®æ¨™æº–ã§æä¾›ã•ã‚Œã‚‹å®Ÿè£…ã®ã†ã¡ã‚¨ãƒ©ãƒ¼ã£ã½ã„ã‚‚ã®ã‚„ `Result<T, E>` ã«ã¤ã„ã¦è¦‹ã¾ã—ãŸã€‚

æ¬¡å›ã¯ axum crate ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã«ã¤ã„ã¦è¦‹ã¾ã™ã€‚
