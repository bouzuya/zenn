---
emoji: "ğŸ’¬"
publication_name: "doctormate"
published: true
published_at: 2026-01-12 12:00
title: "axum crate ã® Extractor"
topics: ["rust"]
type: "tech"
---

# axum crate ã® Extractor

[å‰å›ã¯ axum crate ã® Handler ã®å®Ÿè£…ã‚’è¿½ã„ã‹ã‘ã¦ã¿ã¾ã—ãŸ](https://zenn.dev/doctormate/articles/7f7114a3b12e87)ã€‚

ä»Šå›ã¯ axum crate ã® Extractor ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚

ä»Šå›ã‚‚ axum crate ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ 0.8.4 ã§ã™ã€‚

## axum crate ã® Extractor ã¨ã¯

axum crate ã® Extractor ã¯ `FromRequest` ã¾ãŸã¯ `FromRequestParts` ã‚’å®Ÿè£…ã—ãŸå‹ã§ã™ã€‚ Handler ã®å¼•æ•°ã¨ã—ã¦ 0 å€‹ä»¥ä¸Šã® Extractor ã‚’æŒ‡å®šã§ãã¾ã™ã€‚

ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰å€¤ã‚’æŠ½å‡º (extract) ã™ã‚‹ã‹ã‚‰ Extractor ã¨ã„ã†ã“ã¨ã§ã—ã‚‡ã†ã€‚

<https://docs.rs/axum/0.8.4/axum/index.html#extractors>
<https://docs.rs/axum/0.8.4/axum/extract/index.html>

## ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã® Extractor

ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã® Extractor ã‚’èª¿ã¹ã‚‹ã«ã¯ `FromRequestParts` trait ã¨ `FromRequest` trait ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰ãŸã©ã‚‹ã¨è‰¯ã•ãã†ã§ã™ã€‚

<https://docs.rs/axum/0.8.4/axum/extract/trait.FromRequestParts.html>
<https://docs.rs/axum/0.8.4/axum/extract/trait.FromRequest.html>

æ¬¡ã®ã‚ˆã†ãªå‹ã¸ã®å®Ÿè£…ãŒæä¾›ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

- `FromRequestParts`
    - `()`
    - `Extensions`
    - `HeaderMap`
    - `Method`
    - `Parts`
    - `Uri`
    - `Version`
    - `(T1,)`
    - `(T1, T2)`
    - `(T1, ..., T16)`
    - `Option<T>` `T: OptionalFromRequestParts<S>`
    - `Result<T, T::Rejection>` `T: OptionalFromRequestParts<S>`
    - `State<InnerState>`
    - `MatchedPath`
    - `NestedPath`
    - `OriginalUri`
    - `RawPathParams`
    - `RawQuery`
    - `WebSocketUpgrade<DefaultOnFailedUpgrade>`
    - `ConnectInfo<T>`
    - `Extension<T>`
    - `Path<T>`
    - `Query<T>`
- `FromRequest`
    - `String`
    - `Bytes`
    - `BytesMut`
    - `Request<Body>`
    - `(T1,)`
    - `(T1, T2)`
    - `(T1, ..., T16)`
    - `Option<T>` `T: OptionalFromRequest<S>`
    - `Result<T, T::Rejection>` `T: OptionalFromRequest<S>`
    - `Body`
    - `Multipart`
    - `RawForm`
    - `T` `T: FromRequestParts<S>`
    - `Form<T>`
    - `Json<T>`

`HeaderMap`, `Path`, `Query`, `State`, `Json` ãªã©ã‚ˆãè¦‹ã‚‹ã‚‚ã®ã‹ã‚‰ã€ `Option` ã‚„ `Result` ãªã©ã¡ã‚‡ã£ã¨ã‚¯ã‚»ã®ã‚ã‚Šãã†ãªã‚‚ã®ã¾ã§ã‚ã‚Šã¾ã™ã­ã€‚ `Request` ã¨ã„ã†ç›´æ¥çš„ã«å—ã‘å–ã‚‹ã‚‚ã®ã‚‚ã‚ã‚Šã¾ã™ã€‚

ã»ã‹ã«ã¯ `FromRequestParts` ã¯åŒæ™‚ã« `FromRequest` ã§ã‚‚ã‚ã‚‹ã“ã¨ã‚‚åˆ†ã‹ã‚Šã¾ã™ã€‚

`Option` ã®ãƒˆãƒ¬ã‚¤ãƒˆå¢ƒç•Œã® `OptionalFromRequest` ã¨ `OptionalFromRequestParts` ã«ã¤ã„ã¦ã‚‚æ°—ã«ãªã‚Šã¾ã™ã€‚

## FromRequest ã¨ FromRequestParts ã®é•ã„

[å‰å›](https://zenn.dev/doctormate/articles/7f7114a3b12e87)ã® `impl_handler` ãƒã‚¯ãƒ­ã®ãƒˆãƒ¬ã‚¤ãƒˆå¢ƒç•Œã«å‡ºã¦ããŸã¨ãŠã‚Šã€ Handler ã®æœ€å¾Œã®å¼•æ•°ã¯ `FromRequest<S, M> + Send` ã¨ã„ã†ãƒˆãƒ¬ã‚¤ãƒˆå¢ƒç•Œã§ã€ãã‚Œä»¥å¤–ã®å¼•æ•°ã¯ `FromRequestParts<S> + Send` ã¨ã„ã†ãƒˆãƒ¬ã‚¤ãƒˆå¢ƒç•Œã§ã™ã€‚

`FromRequest` ã¯ request body ã‚’æ¶ˆè²»ã™ã‚‹ã®ã§æœ€å¾Œã® 1 å›ã ã‘æŒ‡å®šã§ãã¾ã™ã€‚

`FromRequestParts` ã¯ request body ã‚’æ¶ˆè²»ã—ãªã„ã®ã§è¤‡æ•°å›æŒ‡å®šã§ãã¾ã™ã€‚

`FromRequest` ã¨ `FromRequestParts` ã®é•ã„ã¯ request body ã‚’æ¶ˆè²»ã™ã‚‹ã‹ã©ã†ã‹ã€ã²ã¨ã¤ã® Handler ã«ä½•å›æŒ‡å®šã§ãã‚‹ã‹ã€ã©ã“ã§æŒ‡å®šã§ãã‚‹ã‹ãŒåŸºæœ¬ã¨ã„ã†ã“ã¨ã§ã™ã­ã€‚

ã•ãã»ã©ã® `impl FromRequest` ã®ä¸€è¦§ã‹ã‚‰ã‚‚ request body ã‚’ã©ã†è§£é‡ˆã™ã‚‹ã‹ã¨ã„ã†ã‚‚ã®ãªã®ãŒèª­ã¿å–ã‚Œãã†ã§ã™ã­ã€‚

## FromRequest ã®å®šç¾©

`FromRequest` ã®å®šç¾©ã‚’è¦‹ã¾ã™ã€‚

<https://docs.rs/axum/0.8.4/axum/extract/trait.FromRequest.html>
<https://docs.rs/axum-core/0.5.2/src/axum_core/extract/mod.rs.html#85>

```rust
pub trait FromRequest<S, M = ViaRequest>: Sized {
    type Rejection: IntoResponse;

    // Required method
    fn from_request(
        req: Request<Body>,
        state: &S,
    ) -> impl Future<Output = Result<Self, Self::Rejection>> + Send;
}
```

`from_request` ã¯ `Request<Body>` ã‚’ã¨ã£ã¦ã„ã¾ã™ã€‚

request (body) ã‚’æ¶ˆè²»ã—ã¦ã„ã¾ã™ã­ã€‚

## FromRequestParts ã®å®šç¾©

`FromRequestParts` ã®å®šç¾©ã‚’è¦‹ã¾ã™ã€‚

<https://docs.rs/axum/0.8.4/axum/extract/trait.FromRequestParts.html>
<https://docs.rs/axum-core/0.5.2/src/axum_core/extract/mod.rs.html#56>

```rust
pub trait FromRequestParts<S>: Sized {
    type Rejection: IntoResponse;

    // Required method
    fn from_request_parts(
        parts: &mut Parts,
        state: &S,
    ) -> impl Future<Output = Result<Self, Self::Rejection>> + Send;
}
```

`from_request_parts` ã¯ `&mut Parts` ã‚’ã¨ã£ã¦ã„ã¾ã™ã€‚

`Parts` ã¯ `http::request::Parts` ã§ã™ã€‚

<https://docs.rs/http/1.3.1/http/request/struct.Parts.html>

```rust
pub struct Parts {
    pub method: Method,
    pub uri: Uri,
    pub version: Version,
    pub headers: HeaderMap<HeaderValue>,
    pub extensions: Extensions,
    /* private fields */
}
```

request body ã¯å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ `&mut Parts` ã®ã¨ãŠã‚Šã€å‚ç…§ã‚’æ¸¡ã•ã‚Œã¦ã„ã¾ã™ã€‚

## ãŠã‚ã‚Šã«

ä»Šå›ã¯ Extractor ã®ãŸã‚ã®ãƒˆãƒ¬ã‚¤ãƒˆã§ã‚ã‚‹ `FromRequest` ã¨ `FromRequestParts` ã®å®šç¾©ãªã©ã‚’è¦‹ã¾ã—ãŸã€‚

æ¬¡å›ã¯ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã® Extractor ã‚’è¦‹ã¦ã¿ã¾ã™ã€‚
