---
emoji: "ğŸ¦”"
publication_name: "doctormate"
published: true
published_at: 2026-03-02 12:00
title: "axum crate ã® middleware"
topics: ["rust"]
type: "tech"
---

[å‰å›ã¯ axum crate ã® ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’è¦‹ã¾ã—ãŸ](https://zenn.dev/doctormate/articles/0ae1263c351356)ã€‚

ä»Šå›ã¯ axum ã® middleware ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ (ã®å‰åŠ) ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚

ä»Šå›ã‚‚ axum crate ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ 0.8.4 ã§ã™ã€‚

## axum ã® middleware

ã¾ãšã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¦‹ã¦ã„ãã¾ã™ã€‚

<https://docs.rs/axum/0.8.4/axum/middleware/index.html>

[ç¬¬ä¸€å›ã® axum ã®æ¦‚è¦](https://zenn.dev/doctormate/articles/37c97d448cc218) ã§ã‚‚è§¦ã‚ŒãŸã®ã§ã™ãŒã€ axum ã¯ middleware ã‚’ç‹¬è‡ªã«ã¯æŒãŸãšã€ä»£ã‚ã‚Šã« `tower` ã‚’ä½¿ã£ã¦ã„ã‚‹ã“ã¨ãŒæ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚

ã¾ãŸ `tower` crate ã®ã‚¬ã‚¤ãƒ‰ã‚’èª­ã‚€ã‚ˆã†ã«ã™ã™ã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚å®Œå…¨ãªç†è§£ã¯ã›ãšã¨ã‚‚åŸºæœ¬çš„ãªã¨ã“ã‚ã¯ç†è§£ã™ã¹ãã¨ã®ã“ã¨ã§ã™ã€‚ãƒŸãƒ¼ãƒ çš„ã«ã€Œå®Œå…¨ã«ç†è§£ã—ãŸã€ã¯ã‚ã¾ã‚Šå®Œå…¨ã§ã¯ãªã•ãã†ã§ã™ãŒâ€¦â€¦ã€‚

<https://github.com/tower-rs/tower/tree/master/guides>

ã“ã‚Œã¯èª­ã¿å‡ºã™ã¨çµ‚ã‚ã‚‰ãªã„ã®ã§åˆ¥ã®æ©Ÿä¼šã«ã€‚

ã‚ã¨ã¯ `tower::ServiceBuilder` ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚€ã“ã¨ã‚‚ã™ã™ã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

<https://docs.rs/tower/0.5.2/tower/builder/struct.ServiceBuilder.html>

## Middleware ã®é©ç”¨ç®‡æ‰€

æ¬¡ã¯ Middleware ã®é©ç”¨ç®‡æ‰€ã«ã¤ã„ã¦æ›¸ã„ã¦ã‚ã‚Šã¾ã™ã€‚

- Router å˜ä½ã§ã®é©ç”¨ (`Router::layer` ã¨ `Router::route_layer`)
- MethodRouter å˜ä½ã§ã®é©ç”¨ (`MethodRouter::layer` ã¨ `MethodRouter::route_layer`)
- Handler å˜ä½ã§ã®é©ç”¨ (`Handler::layer`)

ã“ã®ã‚ãŸã‚Šã¯ Router ã‚„ Handler ã®å›ã§ã‚‚ã™ã“ã—ã¯è¦‹ã¦ã„ã¾ã™ã­ã€‚

## è¤‡æ•° Middleware ã®é©ç”¨ã¨é †åº

è¤‡æ•°ã® Middleware ã®é©ç”¨ã¯ `tower::ServiceBuilder` ã‚’ä½¿ã†ã“ã¨ã‚’ã™ã™ã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

ç¶šã„ã¦é †åºã€‚ `Router::layer` ã¯å¾Œã‹ã‚‰è¶³ã—ãŸã‚‚ã®ã§ wrap ã•ã‚Œã‚‹ã®ã§ã€ä¸‹ã‹ã‚‰ä¸Š (å³å¯†ã«ã¯å†…ã‹ã‚‰å¤–) ã®é †ã€‚ `tower::ServiceBuilder` ã¯é€†ã«ä¸Šã‹ã‚‰ä¸‹ã®é †ã€‚ã“ã‚Œã¯ç´›ã‚‰ã‚ã—ã„ã§ã™ã­â€¦â€¦ã€‚

ã‚ˆã‚Šç›´æ„Ÿçš„ãªé †åºã«ãªã£ã¦ã„ã‚‹ `tower::ServiceBuilder` ã‚’æ¨å¥¨ã™ã‚‹ã¨ã®ã“ã¨ã€‚

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯å›³ãŒã‚ã‚‹ã®ã§ã€ãã¡ã‚‰ã‚‚åˆ†ã‹ã‚Šã‚„ã™ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

## Middleware ã®ä½œæˆ (WIP)

- `axum::middleware::from_fn`
- `axum::middleware::from_extractor`
- `tower::ServiceBuilder::map_request`
- `tower::ServiceBuilder::map_response`
- `tower::ServiceBuilder::then`
- `tower::ServiceBuilder::and_then`
- `tower::Service` (æœ€å¤§ã®åˆ¶å¾¡)

<https://github.com/tower-rs/tower/blob/master/guides/building-a-middleware-from-scratch.md>

## ãŠã‚ã‚Šã«

TODO
