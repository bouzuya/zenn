---
emoji: "ğŸ˜½"
publication_name: "doctormate"
published: true
published_at: 2026-01-26 12:00
title: "axum crate ã® FromRequestParts ã®æ¨™æº–ã§æä¾›ã•ã‚Œã‚‹å®Ÿè£…"
topics: ["rust"]
type: "tech"
---

[å‰å›ã¯ axum crate ã® Extractor ã®ãƒˆãƒ¬ã‚¤ãƒˆã‚’ã–ã£ã¨è¦‹ã¾ã—ãŸ](https://zenn.dev/doctormate/articles/10745f66b57301)ã€‚

ä»Šå›ã¯ axum crate ã®ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ Extractor ã®å®Ÿè£…ã€ç‰¹ã« `FromRequstParts` ã®ã‚‚ã®ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚

ä»Šå›ã‚‚ axum crate ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ 0.8.4 ã§ã™ã€‚

## axum crate ã®ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ Extractor ã¨ã¯

axum ã«ãŠã‘ã‚‹ Extractor ã¨ã¯ `FromRequestParts` trait ã¾ãŸã¯ `FromRequest` trait ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ã‚‚ã®ã§ã™ã€‚ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã€€Extractor ã¯ axum crate æœ¬ä½“ãŒæä¾›ã—ã¦ã„ã‚‹ãã‚Œã‚‰ã® trait ã®å®Ÿè£…ã§ã™ã€‚

ä»Šå›ã¯ `FromRequestParts` ã®å®Ÿè£…ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚[å‰å›](https://zenn.dev/doctormate/articles/10745f66b57301)ã¨åŒæ§˜ã«ã€ `FromRequestParts` ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚ã‚‹å®Ÿè£…ã‚’é †ã«è¦‹ã¦ã„ãã¾ã™ã€‚

<https://docs.rs/axum/0.8.4/axum/extract/trait.FromRequestParts.html>


### impl&lt;S&gt; FromRequestParts&lt;S&gt; for ()

<https://docs.rs/axum-core/0.5.2/src/axum_core/extract/tuple.rs.html#6-8>

```rust
impl<S> FromRequestParts<S> for ()
where
    S: Send + Sync,
{
    type Rejection = Infallible;

    async fn from_request_parts(_: &mut Parts, _: &S) -> Result<(), Self::Rejection> {
        Ok(())
    }
}
```

`()` ã‚’è¿”ã™ã®ã¿ (ä½•ã‚‚ã—ã¾ã›ã‚“) ã€‚

### impl&lt;S&gt; FromRequestParts&lt;S&gt; for Extensions

<https://docs.rs/axum-core/0.5.2/src/axum_core/extract/request_parts.rs.html#148-150>

```rust
impl<S> FromRequestParts<S> for Extensions
where
    S: Send + Sync,
{
    type Rejection = Infallible;

    async fn from_request_parts(parts: &mut Parts, _state: &S) -> Result<Self, Self::Rejection> {
        Ok(parts.extensions.clone())
    }
}
```

`parts.extensions` ã‚’ `clone` ã—ã¦è¿”ã™ã®ã¿ã€‚


### impl&lt;S&gt; FromRequestParts&lt;S&gt; for HeaderMap

<https://docs.rs/axum-core/0.5.2/src/axum_core/extract/request_parts.rs.html#57-59>

```rust
impl<S> FromRequestParts<S> for HeaderMap
where
    S: Send + Sync,
{
    type Rejection = Infallible;

    async fn from_request_parts(parts: &mut Parts, _: &S) -> Result<Self, Self::Rejection> {
        Ok(parts.headers.clone())
    }
}
```

`parts.headers` ã‚’ `clone` ã—ã¦è¿”ã™ã®ã¿ã€‚

### impl&lt;S&gt; FromRequestParts&lt;S&gt; for Method

<https://docs.rs/axum-core/0.5.2/src/axum_core/extract/request_parts.rs.html#19-21>

```rust
impl<S> FromRequestParts<S> for Method
where
    S: Send + Sync,
{
    type Rejection = Infallible;

    async fn from_request_parts(parts: &mut Parts, _: &S) -> Result<Self, Self::Rejection> {
        Ok(parts.method.clone())
    }
}
```

`parts.method` ã‚’ `clone` ã—ã¦è¿”ã™ã®ã¿ã€‚

### impl&lt;S&gt; FromRequestParts&lt;S&gt; for Parts

<https://docs.rs/axum-core/0.5.2/src/axum_core/extract/request_parts.rs.html#137-139>

```rust
impl<S> FromRequestParts<S> for Parts
where
    S: Send + Sync,
{
    type Rejection = Infallible;

    async fn from_request_parts(parts: &mut Parts, _state: &S) -> Result<Self, Self::Rejection> {
        Ok(parts.clone())
    }
}
```

`parts` ã‚’ `clone` ã—ã¦è¿”ã™ã®ã¿ã€‚

### impl&lt;S&gt; FromRequestParts&lt;S&gt; for Uri

<https://docs.rs/axum-core/0.5.2/src/axum_core/extract/request_parts.rs.html#30-32>

```rust
impl<S> FromRequestParts<S> for Uri
where
    S: Send + Sync,
{
    type Rejection = Infallible;

    async fn from_request_parts(parts: &mut Parts, _: &S) -> Result<Self, Self::Rejection> {
        Ok(parts.uri.clone())
    }
}
```

`parts.uri` ã‚’ `clone` ã—ã¦è¿”ã™ã®ã¿ã€‚

### impl&lt;S&gt; FromRequestParts&lt;S&gt; for Version

<https://docs.rs/axum-core/0.5.2/src/axum_core/extract/request_parts.rs.html#41-43>

```rust
impl<S> FromRequestParts<S> for Version
where
    S: Send + Sync,
{
    type Rejection = Infallible;

    async fn from_request_parts(parts: &mut Parts, _: &S) -> Result<Self, Self::Rejection> {
        Ok(parts.version)
    }
}
```

`parts.version` ã‚’è¿”ã™ã®ã¿ã€‚


### impl&lt;S, T1, ..., T16&gt; FromRequestParts&lt;S&gt; for (T1, ..., T16)

<https://docs.rs/axum-core/0.5.2/src/axum_core/extract/tuple.rs.html#74>

```rust
all_the_tuples!(impl_from_request);
```

```rust
macro_rules! impl_from_request {
    (
        [$($ty:ident),*], $last:ident
    ) => {
        #[allow(non_snake_case, unused_mut, unused_variables)]
        impl<S, $($ty,)* $last> FromRequestParts<S> for ($($ty,)* $last,)
        where
            $( $ty: FromRequestParts<S> + Send, )*
            $last: FromRequestParts<S> + Send,
            S: Send + Sync,
        {
            type Rejection = Response;

            async fn from_request_parts(parts: &mut Parts, state: &S) -> Result<Self, Self::Rejection> {
                $(
                    let $ty = $ty::from_request_parts(parts, state)
                        .await
                        .map_err(|err| err.into_response())?;
                )*
                let $last = $last::from_request_parts(parts, state)
                    .await
                    .map_err(|err| err.into_response())?;

                Ok(($($ty,)* $last,))
            }
        }

        // ...
    };
}
```

[`all_the_tuples` macro ã¯å‰ã€…å›ã«å‡ºã¦ãã¾ã—ãŸ](https://zenn.dev/doctormate/articles/7f7114a3b12e87#all_the_tuples-macro) ã€‚ macro ã®å‘¼ã³å‡ºã—ã‚’ T1 ã‹ã‚‰ T1, .., T16 ã¾ã§ã®å¯å¤‰ã®ã‚‚ã®ã«å¯¾ã—ã¦å®Ÿè¡Œã™ã‚‹ã‚‚ã®ã§ã™ã€‚

ä»Šå›ã¯ `impl_from_request` macro ã‚’ `all_the_tuples` ã«æ¸¡ã—ã¦ã„ã¾ã™ã€‚

å„å¼•æ•° (`FromRequestParts<S> + Send`) ã«å¯¾ã—ã¦ `from_request_parts` ã—ã¦å¤±æ•—æ™‚ã¯ `err.into_response()` ã— response ã‚’è¿”ã—ã¦ã„ã¾ã™ã€‚ ã™ã¹ã¦æˆåŠŸã—ãŸéš›ã¯ tuple ã«è©°ã‚ã¦è¿”ã—ã¦ã„ã¾ã™ã€‚

`FromRequestParts` ã®é–¢é€£å‹ `Rejection` ã¯å®šç¾©ã‹ã‚‰ `IntoResponse` ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ã®ã§ `into_response` ã§ãã¾ã™ã€‚

<https://docs.rs/axum/0.8.4/axum/extract/trait.FromRequestParts.html>

```rust
pub trait FromRequestParts<S>: Sized {
    type Rejection: IntoResponse;

    // Required method
    fn from_request_parts(
        parts: &mut Parts,
        state: &S,
    ) -> impl Future<Output = Result<Self, Self::Rejection>> + Send;
}
```

### impl&lt;S, T&gt; FromRequestParts&lt;S&gt; for Option&lt;T&gt;

<https://docs.rs/axum-core/0.5.2/src/axum_core/extract/option.rs.html#38-41>

```rust
impl<S, T> FromRequestParts<S> for Option<T>
where
    T: OptionalFromRequestParts<S>,
    S: Send + Sync,
{
    type Rejection = T::Rejection;

    fn from_request_parts(
        parts: &mut Parts,
        state: &S,
    ) -> impl Future<Output = Result<Option<T>, Self::Rejection>> {
        T::from_request_parts(parts, state)
    }
}
```

`OptionalFromRequestParts<S>` ãª `T` ãŒ `Option<T>` ã®å½¢ã§ Extractor ã¨ã—ã¦æŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã¨ãã€ `T::from_request_parts` ã«ä»»ã›ã‚‹ã€ã¨ã€‚

`OptionFromRequestParts` ã®å®šç¾©ã‚’è¦‹ã¾ã™ã€‚

<https://docs.rs/axum/0.8.4/axum/extract/trait.OptionalFromRequestParts.html>

```rust
pub trait OptionalFromRequestParts<S>: Sized {
    type Rejection: IntoResponse;

    // Required method
    fn from_request_parts(
        parts: &mut Parts,
        state: &S,
    ) -> impl Future<Output = Result<Option<Self>, Self::Rejection>> + Send;
}
```

`Option` ãŒè¿”ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ãŠã‚Šã€å–å¾—ã§ããªã„å ´åˆã« `None` ã‚’è¿”ã™é¸æŠè‚¢ãŒã‚ã‚‹ã‚ã‘ã§ã™ã­ã€‚

æ¨™æº–ã§ã¯â†“ã®å®Ÿè£…ãŒæä¾›ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

- `impl<S> OptionalFromRequestParts<S> for MatchedPath`
- `impl<T, S> OptionalFromRequestParts<S> for Extension<T>`
- `impl<T, S> OptionalFromRequestParts<S> for Path<T>`


### impl&lt;S, T&gt; FromRequestParts&lt;S&gt; for Result&lt;T, T::Rejection&gt;

<https://docs.rs/axum-core/0.5.2/src/axum_core/extract/mod.rs.html#113-116>

```rust
impl<S, T> FromRequestParts<S> for Result<T, T::Rejection>
where
    T: FromRequestParts<S>,
    S: Send + Sync,
{
    type Rejection = Infallible;

    async fn from_request_parts(parts: &mut Parts, state: &S) -> Result<Self, Self::Rejection> {
        Ok(T::from_request_parts(parts, state).await)
    }
}
```

é€šå¸¸ã¯å¤±æ•—æ™‚ã® `into_response` ã®å‘¼ã³å‡ºã—ã¾ã§ã—ã¦ã—ã¾ã†ã¨ã“ã‚ã‚’ã€`Result<T, T::Rejection>` ã®å ´åˆã¯ `Result` ã®ã¾ã¾è¿”ã—ã¦ã„ã¾ã™ã€‚

Extractor ã®ã‚¨ãƒ©ãƒ¼ã‚’ä»»æ„ã®å½¢ã«å¤‰æ›´ã—ãŸã„å ´åˆã«éƒ½åˆãŒè‰¯ã„ã¨ã„ã†ã“ã¨ã§ã™ã­ã€‚


## ãŠã‚ã‚Šã«

ä»Šå›ã¯ axum crate ã® `FromRequstParts` ã®æ¨™æº–ã§æä¾›ã•ã‚Œã¦ã„ã‚‹å®Ÿè£…ã‚’è¦‹ã¾ã—ãŸã€‚

æ¬¡å›ã¯ `FromRequest` ã®æ¨™æº–ã§æä¾›ã•ã‚Œã¦ã„ã‚‹å®Ÿè£…ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚
